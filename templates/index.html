<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitch Clip Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 40px 20px;
            color: white;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .tab.active {
            border-color: #667eea;
            background: #f0f0ff;
        }
        
        .tab:hover {
            border-color: #667eea;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        input[type="text"],
        input[type="file"],
        input[type="number"] {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .settings {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 600px) {
            .settings {
                grid-template-columns: 1fr;
            }
        }
        
        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .progress-section {
            display: none;
            margin-top: 20px;
        }
        
        .progress-section.active {
            display: block;
        }
        
        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            color: #666;
        }
        
        .clips-section {
            display: none;
            margin-top: 20px;
        }
        
        .clips-section.active {
            display: block;
        }
        
        .clip-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .clip-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .clip-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }
        
        .download-btn {
            padding: 8px 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            font-size: 14px;
        }
        
        .download-btn:hover {
            background: #218838;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé¨ Twitch Clip Generator</h1>
            <p>Convert streams into viral short-form videos with auto-captions</p>
        </header>
        
        <div class="card">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('url')">üì∫ Twitch/YouTube URL</button>
                <button class="tab" onclick="switchTab('upload')">üìÅ Upload Video</button>
            </div>
            
            <!-- URL Input -->
            <div id="url-section">
                <div class="input-group">
                    <label>Video URL</label>
                    <input type="text" id="video-url" placeholder="https://www.twitch.tv/videos/123456789">
                </div>
            </div>
            
            <!-- File Upload -->
            <div id="upload-section" class="hidden">
                <div class="input-group">
                    <label>Select Video File</label>
                    <input type="file" id="video-file" accept="video/*">
                </div>
            </div>
            
            <!-- Settings -->
            <div class="settings">
                <div class="input-group">
                    <label>Min Duration (s)</label>
                    <input type="number" id="min-duration" value="15" min="5" max="300">
                </div>
                <div class="input-group">
                    <label>Max Duration (s)</label>
                    <input type="number" id="max-duration" value="60" min="10" max="300">
                </div>
                <div class="input-group">
                    <label>Max Clips</label>
                    <input type="number" id="max-clips" value="5" min="1" max="20">
                </div>
            </div>
            
            <button class="btn" id="process-btn" onclick="startProcessing()">
                ‚ú® Generate Clips
            </button>
            
            <!-- Progress -->
            <div id="progress-section" class="progress-section">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <div class="progress-text" id="progress-text">Starting...</div>
            </div>
            
            <!-- Results -->
            <div id="clips-section" class="clips-section">
                <h3>üéâ Your Clips</h3>
                <div id="clips-list"></div>
            </div>
            
            <!-- Messages -->
            <div id="message-area"></div>
        </div>
        
        <div class="card" style="text-align: center;">
            <h3>How it works</h3>
            <p style="color: #666; line-height: 1.6;">
                1. Paste a Twitch/YouTube URL or upload a video<br>
                2. AI transcribes and finds viral moments<br>
                3. Generates vertical clips with subtitles<br>
                4. Download and post to TikTok/Reels/Shorts
            </p>
        </div>
    </div>
    
    <script>
        let currentTab = 'url';
        let jobId = null;
        let statusInterval = null;
        
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            if (tab === 'url') {
                document.getElementById('url-section').classList.remove('hidden');
                document.getElementById('upload-section').classList.add('hidden');
            } else {
                document.getElementById('url-section').classList.add('hidden');
                document.getElementById('upload-section').classList.remove('hidden');
            }
        }
        
        function showMessage(text, type) {
            const area = document.getElementById('message-area');
            area.innerHTML = `<div class="${type}">${text}</div>`;
            setTimeout(() => area.innerHTML = '', 5000);
        }
        
        async function startProcessing() {
            const btn = document.getElementById('process-btn');
            const minDuration = parseInt(document.getElementById('min-duration').value);
            const maxDuration = parseInt(document.getElementById('max-duration').value);
            const maxClips = parseInt(document.getElementById('max-clips').value);
            
            btn.disabled = true;
            btn.textContent = 'Processing...';
            document.getElementById('progress-section').classList.add('active');
            document.getElementById('clips-section').classList.remove('active');
            
            try {
                let response;
                
                if (currentTab === 'url') {
                    const url = document.getElementById('video-url').value.trim();
                    if (!url) {
                        showMessage('Please enter a video URL', 'error');
                        return;
                    }
                    
                    response = await fetch('/api/process', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            url: url,
                            min_duration: minDuration,
                            max_duration: maxDuration,
                            max_clips: maxClips
                        })
                    });
                } else {
                    const fileInput = document.getElementById('video-file');
                    if (!fileInput.files[0]) {
                        showMessage('Please select a video file', 'error');
                        return;
                    }
                    
                    const formData = new FormData();
                    formData.append('video', fileInput.files[0]);
                    formData.append('min_duration', minDuration);
                    formData.append('max_duration', maxDuration);
                    formData.append('max_clips', maxClips);
                    
                    response = await fetch('/api/upload', {
                        method: 'POST',
                        body: formData
                    });
                }
                
                const data = await response.json();
                
                if (data.error) {
                    showMessage(data.error, 'error');
                    btn.disabled = false;
                    btn.textContent = '‚ú® Generate Clips';
                    return;
                }
                
                jobId = data.job_id;
                startStatusPolling();
                
            } catch (error) {
                showMessage('Error: ' + error.message, 'error');
                btn.disabled = false;
                btn.textContent = '‚ú® Generate Clips';
            }
        }
        
        function startStatusPolling() {
            statusInterval = setInterval(async () => {
                try {
                    const response = await fetch(`/api/status/${jobId}`);
                    const data = await response.json();
                    
                    updateProgress(data);
                    
                    if (data.status === 'completed') {
                        clearInterval(statusInterval);
                        loadClips();
                    } else if (data.status === 'failed') {
                        clearInterval(statusInterval);
                        showMessage('Failed: ' + (data.error || 'Unknown error'), 'error');
                        resetButton();
                    }
                } catch (error) {
                    console.error('Status check failed:', error);
                }
            }, 2000);
        }
        
        function updateProgress(data) {
            const fill = document.getElementById('progress-fill');
            const text = document.getElementById('progress-text');
            
            fill.style.width = data.progress + '%';
            
            const statusText = {
                'queued': 'Waiting to start...',
                'downloading': 'Downloading video...',
                'processing': 'Analyzing and transcribing...',
                'completed': 'Complete!',
                'failed': 'Failed'
            };
            
            text.textContent = statusText[data.status] || data.status;
        }
        
        async function loadClips() {
            try {
                const response = await fetch(`/api/clips/${jobId}`);
                const data = await response.json();
                
                const list = document.getElementById('clips-list');
                list.innerHTML = '';
                
                if (data.clips.length === 0) {
                    showMessage('No clips generated', 'error');
                    resetButton();
                    return;
                }
                
                data.clips.forEach(clip => {
                    const item = document.createElement('div');
                    item.className = 'clip-item';
                    item.innerHTML = `
                        <div class="clip-info">
                            <div class="clip-icon">üé¨</div>
                            <div>
                                <div style="font-weight: 600;">${clip.filename}</div>
                                <div style="color: #666; font-size: 14px;">${clip.size_mb} MB</div>
                            </div>
                        </div>
                        <a href="${clip.download_url}" class="download-btn" download>‚¨á Download</a>
                    `;
                    list.appendChild(item);
                });
                
                document.getElementById('clips-section').classList.add('active');
                resetButton();
                
            } catch (error) {
                showMessage('Error loading clips: ' + error.message, 'error');
                resetButton();
            }
        }
        
        function resetButton() {
            const btn = document.getElementById('process-btn');
            btn.disabled = false;
            btn.textContent = '‚ú® Generate Clips';
        }
    </script>
</body>
</html>
